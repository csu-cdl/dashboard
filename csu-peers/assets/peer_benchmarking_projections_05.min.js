$(document).ready(function(){"use strict";var e="?v=36",t={selected_tab_name:"projections",campus:"Bakersfield",grad_year:"4yr",cohort:"2008",years:[],years_all:[],peer_count:5,trends_since:"0",type:"GR",max_6yr:"2008",system_goals:{"4yr_lower":30,"4yr_upper":35,"4yr_upper2":40,"6yr_lower":65,"6yr_upper":70},yearmap:{"6yr":{2e3:1,2001:2,2002:3,2003:4,2004:5,2005:6,2006:7,2007:8,2008:9},"4yr":{2e3:3,2001:4,2002:5,2003:6,2004:7,2005:8,2006:9,2007:10,2008:11}},projected_years:["2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023","2024","2025"],projected_campuses:"default",loaded:!1,notify:null,palette:["#f00","#0f3","#00f","#0df","#f0f","#fe0","#f90","#b3a","#f3a","#60f","#0af","#0dc","#6da","#6ad","#a6d","#ad6","#da6","#d6a","#6a6","#a6a","#a66","#66a","#aa6","#6aa","#06a","#6a0"]};t.notify=function(){$(".control").trigger("state_change",[t])},Highcharts.setOptions({colors:t.palette});var n=new RegExp("[$%,]","g"),r=new RegExp(" ","g"),i,s,o,u,a=function(e){var t=e;return t=t.replace("California State University-","CSU "),t=t.replace("California State Polytechnic University-","CSU "),t=t.replace("California Polytechnic State University-","CSU "),t},f=function(e){var t=["Bakersfield","Channel Islands","Chico","Dominguez Hills","East Bay","Fresno","Fullerton","Long Beach","Los Angeles","Monterey Bay","Northridge","Pomona","Sacramento","San Bernardino","San Luis Obispo","San Marcos","Stanislaus"];return t.indexOf(e)!==-1?"CSU "+e:e==="Maritime Academy"?"California Maritime Academy":e+" State University"},l=function(e){var t=e;return t=t.replace(new RegExp("CUNY John Jay College.*$"),"CUNY John Jay College"),t=t.replace(new RegExp("Bowling Green State University.*$"),"Bowling Green State University"),t=t.replace(new RegExp("University of South Florida.*$"),"University of South Florida"),t=t.replace(new RegExp("University of New Mexico.*$"),"University of New Mexico"),t=t.replace(new RegExp("New Mexico State University.*$"),"New Mexico State University"),t},c=function(e,t){return t==="California State University-"+e||t==="California "+e||t==="California State Polytechnic University-"+e||t==="California Polytechnic State University-"+e||t===e+" State University"},h=function(e,t){$("#container").highcharts({credits:{enabled:!1},chart:{type:"column"},title:{text:e.grad_year.slice(0,1)+"-Year Graduation Rate for First-Time, Full-Time Freshmen"},subtitle:{text:e.cohort+" Cohort"},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"% Graduated"}},legend:{enabled:!1},tooltip:{pointFormat:"Rate:{point.y:.0f}%"},series:[{data:t}]})},p=function(e,t){$("#projections_chart_container").highcharts({credits:{enabled:!1},chart:{height:700,width:1e3,type:"line",spacingTop:20,spacingLeft:20,reflow:!1,marginBottom:400},title:{text:"Graduation Rate Projections for First-Time, Full-Time Freshmen",x:-20},xAxis:{categories:e.years_all},yAxis:{title:{text:"% Grad Rate"},plotLines:[{value:0,width:1,color:"#777"}]},tooltip:{pointFormat:"{point.y: ,.0f}%"},legend:{title:{style:{color:"#777"},text:""},layout:"horizontal",align:"center",width:900,itemWidth:440,borderWidth:0,verticalAlign:"top",floating:!0,y:320,x:10},series:t})},d=function(e,t){$("#trends_chart_container").highcharts({credits:{enabled:!1},chart:{height:740,width:750,type:"line",spacingTop:20,spacingLeft:10,marginRight:10,marginBottom:440,reflow:!1},title:{text:"Graduation Rate Trends for First-Time, Full-Time Freshmen",x:0},xAxis:{categories:e.years},yAxis:{title:{text:"% Grad Rate"},plotLines:[{value:0,width:1,color:"#777"}]},tooltip:{valueSuffix:"%"},legend:{title:{style:{color:"#777"},text:"(Click to show/hide campuses)"},layout:"horizontal",align:"center",width:750,itemWidth:300,borderWidth:0,verticalAlign:"top",floating:!0,y:320,x:100},series:t})},v=function(e,t){var n=[],r;return e.forEach(function(e){e&&e.hasOwnProperty("name")&&(r={name:e.name},r.data=e.data.slice(t),r.lineWidth=e.lineWidth,r.zIndex=e.zIndex,r.visible=e.visible,r.connectNulls=!1,n.push(r))}),n},m=function(e,t){var n=[],r,i=function(e,t,n){n[t]=parseFloat(e),n[t]=isNaN(n[t])?null:n[t]};return t.rows.forEach(function(t){var s=l(t[0]),o=t.slice(1);o.forEach(i),e.grad_year==="4yr"&&(o=o.slice(2)),c(e.campus,s)?r={name:a(s),data:o,lineWidth:4,selected:!0,connectEnds:!0}:n.push({name:a(s),data:o,lineWidth:2,selected:!1,connectEnds:!0})}),n.sort(function(e,t){return t.data.slice(-1)-e.data.slice(-1)}),n.unshift(r),n.forEach(function(e,t,n){e.zIndex=n.length-t}),n},g=function(e,t){var n=t.slice(1).map(function(t,n){return e.projected_campuses==="default"?t.visible=n<e.peer_count-1:t.visible=!0,t});return n.sort(function(e,t){return e.name>t.name?1:e.name===t.name?0:-1}),t[0].visible=!0,n.unshift(t[0]),n},y=function(e,t){var n=!1;e.grad_year!==u&&(u=e.grad_year,n=!0);var i=t[e.campus.replace(r,"_")][e.grad_year],s=[],o=[],a=[],f=[],l=[],c=[],h=[],p=[],d=[],v=[];Object.keys(i.prj).forEach(function(e){o.push(e)}),o.sort(),Object.keys(i.rates).forEach(function(e){s.push(e)}),s.sort(),a=s.concat(o),a.sort(),a=a.filter(function(e,t,n){return t<1||e!==n[t-1]}),e.years_all=a,a.forEach(function(e,t){p.push(null),d.push(null),v.push(null),e===s[s.length-1]&&(p[t]=i.rates[e],d[t]=i.rates[e],v[t]=i.rates[e]),i.upperbound.hasOwnProperty(e)&&(p[t]=i.upperbound[e]),i.lowerbound.hasOwnProperty(e)&&(d[t]=i.lowerbound[e]),i.hasOwnProperty("upperbound2")&&i.upperbound2.hasOwnProperty(e)&&(v[t]=i.upperbound2[e]),i.rates.hasOwnProperty(e)?f.push(i.rates[e]):f.push(null),i.prj.hasOwnProperty(e)?l.push(i.prj[e]):i.average.hasOwnProperty(e)?l.push(i.average[e]):l.push(null),i.psd.hasOwnProperty(e)?c.push(i.psd[e]):i.average.hasOwnProperty(e)?c.push(i.average[e]):c.push(null),i.msd.hasOwnProperty(e)?h.push(i.msd[e]):i.average.hasOwnProperty(e)?h.push(i.average[e]):h.push(null)});var m=!0,g=!0,y=!0,b=!0,w=!0,E=!0,S=!0,x=$("#projections_chart_container").highcharts();x&&!n&&(m=x.get("actual").visible,g=x.get("projected_prj").visible,y=x.get("projected_msd").visible,b=x.get("projected_psd").visible,w=x.get("lowerbound").visible,E=x.get("upperbound").visible,e.grad_year==="4yr"&&(S=x.get("upperbound2").visible));var T=[{name:"Historical Graduation Rates",id:"actual",type:"line",color:"#d00",dashStyle:"Solid",visible:m,dataLabels:{enabled:!0,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"},zIndex:30},marker:{radius:5},zIndex:10,data:f},{name:"Jodie's Methodology",id:"projected_prj",type:"line",color:"#00d",dashStyle:"Dot",visible:g,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:4,symbol:"square"},data:l},{name:"Linear Model - Contribution to "+e.system_goals[e.grad_year+"_lower"]+"% System Goal",id:"lowerbound",type:"line",color:"#0d0",dashStyle:"Solid",visible:w,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:5,symbol:"circle"},connectNulls:!0,zIndex:1,data:d},{name:"Jodie's Methodology +1 Standard Deviation",id:"projected_psd",type:"line",color:"#00d",dashStyle:"Dot",visible:b,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:5,symbol:"diamond"},data:c},{name:"Linear Model - Contribution to "+e.system_goals[e.grad_year+"_upper"]+"% System Goal",id:"upperbound",type:"line",color:"#0d0",dashStyle:"Solid",visible:E,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:5,symbol:"circle"},connectNulls:!0,zIndex:1,data:p},{name:"Jodie's Methodology -1 Standard Deviation",id:"projected_msd",type:"line",color:"#00d",dashStyle:"Dot",visible:y,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:5,symbol:"diamond"},data:h}];return e.grad_year==="4yr"&&T.push({name:"Linear Model - Contribution to "+e.system_goals[e.grad_year+"_upper2"]+"% System Goal",id:"upperbound2",type:"line",color:"#0d0",dashStyle:"Solid",visible:S,dataLabels:{enabled:!1,align:"center",format:"{point.y: ,.0f}%",style:{fontSize:"0.8em"}},marker:{radius:5,symbol:"circle"},connectNulls:!0,zIndex:1,data:v}),T},b=function(e,t){var n=e.years[0],r=e.years.slice(-1)[0],i=e.grad_year[0],s='<tr><td>{name}</td><td class="nowrap">{avg}</td></tr>',o=n+"-"+r+" Average Annual Change in "+i+"&#8209;Year Grad Rates",u='<table class="table table-striped"><tbody>';t.forEach(function(e){var t,n;e.visible&&(!e.data||e.data.slice(-1)[0]===null||e.data[0]===null||e.data.length<=1?t=s.replace("{name}",e.name).replace("{avg}","n/a"):(e.data&&e.data.length>1&&(n=""+Math.round(10*(e.data.slice(-1)[0]-e.data[0])/(e.data.length-1))/10),n.split(".").length===1&&(n+=".0"),t=s.replace("{name}",e.name).replace("{avg}",n+" % points")),u+=t)}),u+="</tbody></table>",$("#text_panel_0").html("<h3>"+o+"</h3>"+u)},w=function(e,t){p(e,y(e,t))},E=function(e,t){var n=[],r=e.yearmap[e.grad_year][e.cohort];t.rows.forEach(function(t,i){var s=t[0],o=parseFloat(t[r]);c(e.campus,s)?(s=a(s),n[i]={name:s,y:o,color:"#635"}):(s=a(s),s=l(s),n[i]={name:s,y:o,color:"#159"})}),n=n.sort(function(e,t){return t.y-e.y});var i=n[0],s=n[1];isNaN(i.y)&&(n[0]=s,n[1]=i),h(e,n)},S=function(e,t){var n={5:-5,3:-3,0:0},r=Object.keys(e.yearmap[e.grad_year]);e.years=r.slice(n[e.trends_since]);var i=v(g(e,m(e,t)),n[e.trends_since]);d(e,i),b(e,i),$("#trends_chart_container").off("click"),$("#trends_chart_container").on("click",function(){b(e,i)}),$("#trends_footnote").html("*Showing "+f(e.campus)+" and its four top performing national peers (based on their "+e.years.slice(-1)[0]+" cohort "+e.grad_year[0]+"-Year graduation rates).")},x=function(e,t){var r=function(e,t,r){var i,s=e.children.length,o=[],u,a;for(i=0;i<s;i+=1)u=e.children[i],a=u.children[t].innerText,o[i]=[a,i,u.innerHTML,u.className||""];var f=document.createDocumentFragment();r==="ascending"?o.sort(function(e,t){var r=e[0].toUpperCase(),i=t[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=isNaN(parseFloat(r))?r:parseFloat(r),i=isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}):o.sort(function(e,t){var r=t[0].toUpperCase(),i=e[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=isNaN(parseFloat(r))?r:parseFloat(r),i=isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}),o.forEach(function(e){var t=document.createElement("tr");e[3].indexOf("highlight")!==-1&&(t.className="highlight"),t.innerHTML=e[2],f.appendChild(t)}),e.innerHTML="",e.appendChild(f,e)},i={},s=[];t.forEach(function(t,n){var o="ord"+n;s.push("#col_"+n),$(s[n]).on("click",function(){!i[o]||i[o]!=="ascending"?i[o]="ascending":i[o]="descending",r(e,n,i[o])});if(t==="never @*%&!ng used")return})},T=function(e){var t=e;return t=t==="Main"?"Campus":t,t=t==="Underrepresented Minority 6-Year Grad Rate"?"URM&nbsp;6-Year Grad&nbsp;Rate":t,t=t==="% Pell Recipients Among Freshmen"?"%&nbsp;Pell Eligible":t,t=t==="% Underrepresented Minority"?"%&nbsp;URM":t,t=t==="Average High School GPA Among College Freshmen"?"Average&nbsp;High School&nbsp;GPA":t,t=t==="Estimated Median SAT / ACT"?"Average SAT&nbsp;Score":t,t=t==="Size (Undergrad FTE)"?"(Undergrad FTE)&nbsp;Size":t,t=t.replace("Grad Rate","Grad&nbsp;Rate"),t},N=function(e,t){var n="<thead><tr>",r,i=e.headers[0];t.grad_year==="4yr"?(r=i[2]==="Underrepresented Minority 6-Year Grad Rate"?2:1,i.splice(1,r,i.splice(-1,1)[0]),i[1]=t.cohort+"&nbsp;4yr Grad&nbsp;Rate"):i.splice(-1,1),i.forEach(function(e,t){e=T(e),t===0?n+='<th id="col_'+t+'" class="col_campus">'+e+"</th>":n+='<th id="col_'+t+'">'+e+"</th>"}),n+="</tr></thead>";var s='<tbody id="tb1">';e.rows.forEach(function(e){var n=e.slice();t.grad_year==="4yr"?n.splice(1,r,n.splice(-1,1)[0]):n.splice(-1,1),n.forEach(function(e,n){var r,i,u='<td class="col_campus"><a href="{link}" target="_blank">{name}</a></td>';e==="-"&&(e="ds*"),n===0?(r=e,i="#",o.hasOwnProperty(r)&&(i=o[r]),c(t.campus,r)?s+='<tr class="highlight">':s+="<tr>",r=l(r),s+=u.replace("{link}",i).replace("{name}",a(r))):s+="<td>"+e+"</td>"}),s+="</tr>"}),s+="</tbody>",$("#desctable").html(n+s),x($("#tb1")[0],e.headers[0])},C=function(t,n){var i=["data/GRtables/",t.campus.replace(r,"_"),"_",t.cohort,"_briefplus.json",e];$.ajax({url:i.join(""),datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},k=function(e,t,n){var r="";if(n&&typeof n=="function")r=n(t);else{var i=[];t.headers[0].forEach(function(e){e.length&&e[0]==='"'?i.push(e):i.push('"'+e+'"')}),r+=i.join(",")+"\n",t.rows.forEach(function(e){var t=[];e.forEach(function(e){e.length&&e[0]==='"'?t.push(e):t.push('"'+e+'"')}),r+=t.join(",")+"\n"})}var s=function(e,t,n){var r="data:application/octet-stream,",i=r+encodeURIComponent(n);e.setAttribute("href",i),e.setAttribute("download",t)},o=function(e,t){var n=document.createElement("a");s(n,e,t),document.body.appendChild(n),n.click(),document.body.removeChild(n)};o("Projected_Trends_"+e.grad_year+"_for_"+e.campus+".csv",r)},L=function(t,n){var r="data/peer_campus_urls.json"+e;$.ajax({url:r,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},A=function(t,n){var i=["data/",t.type,t.grad_year,"/",t.campus.replace(r,"_"),"_",t.grad_year,t.type,".json",e];$.ajax({url:i.join(""),datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},O=function(t,n){var r="data/peer_campus_pbdata3.json"+e;$.ajax({url:r,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})};(function(){$("#campus_selector").on("change",function(e){t.campus=e.target.value,t.notify(),A(t,function(e,t){i=e,S(t,i),E(t,i)}),w(t,s),C(t,N)}),$("#cohort_selector_6yr").on("change",function(e){t.cohort=e.target.value,t.notify(),E(t,i),C(t,N)}),$("#cohort_selector_4yr").on("change",function(e){t.cohort=e.target.value,t.notify(),E(t,i),C(t,N)}),$("#year_selector").on("change",function(e){t.grad_year=e.target.value,t.notify(),A(t,function(e,t){i=e,E(t,i),S(t,i)}),w(t,s),C(t,N)}),$("#year_span_selector").on("change",function(e){t.trends_since=e.target.value,S(t,i)}),L(t,function(e,t){o=e,C(t,N)}),O(t,function(e,t){s=e,w(t,s),$("#download_projections_csv").on("click",function(){k(t,i)})}),A(t,function(e,t){i=e,E(t,i),S(t,i),$("#historical_all").on("click",function(){t.projected_campuses!=="all"&&(t.projected_campuses="all",S(t,i))}),$("#historical_reset").on("click",function(){t.projected_campuses="default",S(t,i)}),$("#download_historical_csv").on("click",function(){k(t,i)})}),$("#label_year_selector").on("state_change",function(){var e=["chart","trends","table","projections"];e.indexOf(t.selected_tab_name)!==-1?$("#label_year_selector").show():$("#label_year_selector").hide()}),$("#label_campus_selector").on("state_change",function(){var e=["chart","trends","table","projections"];e.indexOf(t.selected_tab_name)!==-1?$("#label_campus_selector").show():$("#label_campus_selector").hide()}),$("#label_cohort_selector").on("state_change",function(){var e=["chart","table"];e.indexOf(t.selected_tab_name)!==-1?$("#label_cohort_selector").show():$("#label_cohort_selector").hide()}),$("#label_year_span_selector").on("state_change",function(){var e=["trends"];e.indexOf(t.selected_tab_name)!==-1?$("#label_year_span_selector").show():$("#label_year_span_selector").hide()}),$("#cohort_selector_6yr").on("state_change",function(){t.grad_year!=="6yr"?$("#cohort_selector_6yr").hide():(t.cohort>t.max_6yr?($("#cohort_selector_6yr").val(t.max_6yr),t.cohort=t.max_6yr):$("#cohort_selector_6yr").val(t.cohort),$("#cohort_selector_6yr").show())}),$("#cohort_selector_4yr").on("state_change",function(){t.grad_year!=="4yr"?$("#cohort_selector_4yr").hide():($("#cohort_selector_4yr").val(t.cohort),$("#cohort_selector_4yr").show())}),t.notify(),$(".nav-tabs a").on("click",function(e){$(e.target).tab("show"),t.selected_tab_name=e.target.href.split("#")[1],t.notify()}),$(".nav-tabs a").each(function(e,t){e===0&&$(t).tab("show")})})()})