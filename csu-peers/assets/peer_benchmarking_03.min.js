$(document).ready(function(){"use strict";var e="?v=34";Highcharts.setOptions({colors:["#ED361B","#058DC7","#50B432","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4"]});var t={selected_tab_name:"chart",campus:"Bakersfield",grad_year:"6yr",cohort:"2008",years:[],peer_count:5,trends_since:"0",type:"GR",max_6yr:"2008",notify:null};t.notify=function(){$(".control").trigger("state_change",[t])};var n=new RegExp("[$%,]","g"),r=new RegExp(" ","g"),i,s,o=function(e){return e=e.replace("California State University-","CSU "),e=e.replace("California State Polytechnic University-","CSU "),e=e.replace("California Polytechnic State University-","CSU "),e},u=function(e){return e=e.replace(new RegExp("CUNY John Jay College.*$"),"CUNY John Jay College"),e=e.replace(new RegExp("Bowling Green State University.*$"),"Bowling Green State University"),e=e.replace(new RegExp("University of South Florida.*$"),"University of South Florida"),e=e.replace(new RegExp("University of New Mexico.*$"),"University of New Mexico"),e=e.replace(new RegExp("New Mexico State University.*$"),"New Mexico State University"),e},a=function(e,t){return t==="California State University-"+e||t==="California "+e||t==="California State Polytechnic University-"+e||t==="California Polytechnic State University-"+e||t===e+" State University"},f=function(e,t){$("#container").highcharts({chart:{type:"column"},title:{text:e.grad_year.slice(0,1)+"-Year Graduation Rate for First-Time, Full-Time Freshmen"},subtitle:{text:e.cohort+" Cohort"},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"% Graduated"}},legend:{enabled:!1},tooltip:{pointFormat:"Rate:{point.y:.0f}%"},series:[{data:t}]})},l=function(e,t){var n={2e3:1,2001:2,2002:3,2003:4,2004:5,2005:6,2006:7,2007:8,2008:9},r={2e3:3,2001:4,2002:5,2003:6,2004:7,2005:8,2006:9,2007:10,2008:11},i,s,l,c=[];e.grad_year==="6yr"?i=n[e.cohort]:i=r[e.cohort],t.rows.forEach(function(t,n){s=t[0],l=parseFloat(t[i]),a(e.campus,s)?(s=o(s),c[n]={name:s,y:l,color:"#635"}):(s=o(s),s=u(s),c[n]={name:s,y:l,color:"#159"})}),c=c.sort(function(e,t){return t.y-e.y});var h=c[0],p=c[1];isNaN(h.y)&&(c[0]=p,c[1]=h),f(e,c)},c=function(e,t){$("#multiline_chart_container").highcharts({title:{text:"Graduation Rate Trends for First-Time, Full-Time Freshmen",x:-20},xAxis:{categories:e.years},yAxis:{title:{text:"% Grad Rate"},plotLines:[{value:0,width:1,color:"#777"}]},tooltip:{valueSuffix:"%"},legend:{title:{style:{color:"#777"},text:"(Click to show/hide campuses)"},layout:"horizontal",align:"center",width:200,borderWidth:0},series:t}),$("#trends_footnote").html("*Showing "+t[0].name+" and its four top performing national peers (based on their "+e.years.slice(-1)[0]+" cohort "+e.grad_year[0]+"-Year graduation rates).")},h=function(t,n){var i="data/"+t.type+t.grad_year+"/"+t.campus.replace(r,"_")+"_"+t.grad_year+t.type+".json"+e;$.ajax({url:i,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},p=function(e,t){var n=[],r;return e.forEach(function(e){e&&e.hasOwnProperty("name")&&(r={name:e.name},r.data=e.data.slice(t),r.lineWidth=e.lineWidth,n.push(r))}),n},d=function(e,t){var n=[],r,i=function(e,t,n){n[t]=parseFloat(e),n[t]=isNaN(n[t])?null:n[t]};t.rows.forEach(function(t){var s=u(t[0]),f=t.slice(1);f.forEach(i),e.grad_year==="4yr"&&(f=f.slice(2)),a(e.campus,s)?r={name:o(s),data:f,lineWidth:4}:n.push({name:o(s),data:f,lineWidth:2})}),n.sort(function(e,t){return e.data.slice(-1)-t.data.slice(-1)});var s=n.slice(1-e.peer_count);return s.sort(function(e,t){return e.name>t.name?1:e.name===t.name?0:-1}),s.unshift(r),s},v=function(e,t){var n,r,i=e.years[0],s=e.years.slice(-1)[0],o=e.grad_year[0],u='<tr><td>{name}</td><td class="nowrap">{avg}</td></tr>',a=i+"-"+s+" Average Annual Improvement in "+o+"-Year Grad Rates",f='<table class="table table-striped"><tbody>';t.forEach(function(e){!e.data||e.data.slice(-1)[0]===null||e.data[0]===null||e.data.length<=1?n=u.replace("{name}",e.name).replace("{avg}","n/a"):(e.data&&e.data.length>1&&(r=""+Math.round(10*(e.data.slice(-1)[0]-e.data[0])/(e.data.length-1))/10),r.split(".").length===1&&(r+=".0"),n=u.replace("{name}",e.name).replace("{avg}",r+" % points")),f+=n}),f+="</tbody></table>",$("#text_panel_0").html("<h3>"+a+"</h3>"+f)},m=function(e,t){var n={5:-5,3:-3,0:0},r={"4yr":["2000","2001","2002","2003","2004","2005","2006","2007","2008"],"6yr":["2000","2001","2002","2003","2004","2005","2006","2007","2008"]};e.years=r[e.grad_year].slice(n[e.trends_since]);var i=p(d(e,t),n[e.trends_since]);c(e,i),v(e,i)},g=function(e,t){var r=function(e,t,r){var i,s=e.children.length,o=[],u,a;for(i=0;i<s;i+=1)u=e.children[i],a=u.children[t].innerText,o[i]=[a,i,u.innerHTML,u.className||""];var f=document.createDocumentFragment();r==="ascending"?o.sort(function(e,t){var r=e[0].toUpperCase(),i=t[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=isNaN(parseFloat(r))?r:parseFloat(r),i=isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}):o.sort(function(e,t){var r=t[0].toUpperCase(),i=e[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=isNaN(parseFloat(r))?r:parseFloat(r),i=isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}),o.forEach(function(e){var t=document.createElement("tr");e[3].indexOf("highlight")!==-1&&(t.className="highlight"),t.innerHTML=e[2],f.appendChild(t)}),e.innerHTML="",e.appendChild(f,e)},i={},s=[];t.forEach(function(t,n){var o="ord"+n;s.push("#col_"+n),$(s[n]).on("click",function(){!i[o]||i[o]!=="ascending"?i[o]="ascending":i[o]="descending",r(e,n,i[o])})})},y=function(e){return e=e==="Main"?"Campus":e,e=e==="Underrepresented Minority 6-Year Grad Rate"?"URM&nbsp;6-Year Grad&nbsp;Rate":e,e=e==="% Pell Recipients Among Freshmen"?"%&nbsp;Pell Eligible":e,e=e==="% Underrepresented Minority"?"%&nbsp;URM":e,e=e==="Average High School GPA Among College Freshmen"?"Average&nbsp;High School&nbsp;GPA":e,e=e==="Estimated Median SAT / ACT"?"Average SAT&nbsp;Score":e,e=e==="Size (Undergrad FTE)"?"(Undergrad FTE)&nbsp;Size":e,e=e.replace("Grad Rate","Grad&nbsp;Rate"),e},b=function(e,t){var n="<thead><tr>",r,i=e.headers[0];t.grad_year==="4yr"?(r=i[2]==="Underrepresented Minority 6-Year Grad Rate"?2:1,i.splice(1,r,i.splice(-1,1)[0]),i[1]=t.cohort+"&nbsp;4yr Grad&nbsp;Rate"):i.splice(-1,1),i.forEach(function(e,t){e=y(e),t===0?n+='<th id="col_'+t+'" class="col_campus">'+e+"</th>":n+='<th id="col_'+t+'">'+e+"</th>"}),n+="</tr></thead>";var f='<tbody id="tb1">';e.rows.forEach(function(e){var n=e.slice();t.grad_year==="4yr"?n.splice(1,r,n.splice(-1,1)[0]):n.splice(-1,1),n.forEach(function(e,n){var r,i,l='<td class="col_campus"><a href="{link}" target="_blank">{name}</a></td>';e==="-"&&(e="ds*"),n===0?(r=e,i="#",s.hasOwnProperty(r)&&(i=s[r]),a(t.campus,r)?f+='<tr class="highlight">':f+="<tr>",r=u(r),f+=l.replace("{link}",i).replace("{name}",o(r))):f+="<td>"+e+"</td>"}),f+="</tr>"}),f+="</tbody>",$("#desctable").html(n+f),g($("#tb1")[0],e.headers[0])},w=function(t,n){var i="data/GRtables/"+t.campus.replace(r,"_")+"_"+t.cohort+"_briefplus.json"+e;$.ajax({url:i,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},E=function(t,n){var r="data/peer_campus_urls.json"+e;$.ajax({url:r,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})};(function(){$("#campus_selector").on("change",function(e){t.campus=e.target.value,t.notify(),h(t,function(e,t){i=e,m(t,i),l(t,i)}),w(t,b)}),$("#cohort_selector_6yr").on("change",function(e){t.cohort=e.target.value,t.notify(),l(t,i),w(t,b)}),$("#cohort_selector_4yr").on("change",function(e){t.cohort=e.target.value,t.notify(),l(t,i),w(t,b)}),$("#year_selector").on("change",function(e){t.grad_year=e.target.value,t.notify(),h(t,function(e,t){i=e,l(t,i),m(t,i)}),w(t,b)}),$("#year_span_selector").on("change",function(e){t.trends_since=e.target.value,m(t,i)}),E(t,function(e,t){s=e,w(t,b)}),h(t,function(e,t){i=e,l(t,i),m(t,i)}),$("#label_year_selector").on("state_change",function(){["chart","trends","table"].indexOf(t.selected_tab_name)!==-1?$("#label_year_selector").show():$("#label_year_selector").hide()}),$("#label_campus_selector").on("state_change",function(){["chart","trends","table"].indexOf(t.selected_tab_name)!==-1?$("#label_campus_selector").show():$("#label_campus_selector").hide()}),$("#label_cohort_selector").on("state_change",function(){["chart","table"].indexOf(t.selected_tab_name)!==-1?$("#label_cohort_selector").show():$("#label_cohort_selector").hide()}),$("#label_year_span_selector").on("state_change",function(){t.selected_tab_name==="trends"?$("#label_year_span_selector").show():$("#label_year_span_selector").hide()}),$("#cohort_selector_6yr").on("state_change",function(){t.grad_year!=="6yr"?$("#cohort_selector_6yr").hide():(t.cohort>t.max_6yr?($("#cohort_selector_6yr").val(t.max_6yr),t.cohort=t.max_6yr):$("#cohort_selector_6yr").val(t.cohort),$("#cohort_selector_6yr").show())}),$("#cohort_selector_4yr").on("state_change",function(){t.grad_year!=="4yr"?$("#cohort_selector_4yr").hide():($("#cohort_selector_4yr").val(t.cohort),$("#cohort_selector_4yr").show())}),t.notify(),$(".nav-tabs a").on("click",function(e){$(e.target).tab("show"),t.selected_tab_name=e.target.href.split("#")[1],t.notify()})})()})