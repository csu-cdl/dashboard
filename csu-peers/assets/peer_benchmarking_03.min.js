$(document).ready(function(){"use strict";var e="?v=33";Highcharts.setOptions({colors:["#ED361B","#058DC7","#50B432","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4"]});var t;t={selected_tab_name:"chart",campus:"Bakersfield",grad_year:"6yr",cohort:"2008",years:[],peer_count:5,trends_since:"0",type:"GR",max_6yr:"2008",notify:function(){$(".control").trigger("state_change",[t])}};var n=new RegExp("[$%,]","g"),r=new RegExp(" ","g"),i={"4yr":["2000","2001","2002","2003","2004","2005","2006","2007","2008"],"6yr":["2000","2001","2002","2003","2004","2005","2006","2007","2008"]},s={5:-5,3:-3,0:0},o,u,a=function(e){return e=e.replace("California State University-","CSU "),e=e.replace("California State Polytechnic University-","CSU "),e=e.replace("California Polytechnic State University-","CSU "),e},f=function(e){return e=e.replace(new RegExp("CUNY John Jay College.*$"),"CUNY John Jay College"),e=e.replace(new RegExp("Bowling Green State University.*$"),"Bowling Green State University"),e=e.replace(new RegExp("University of South Florida.*$"),"University of South Florida"),e=e.replace(new RegExp("University of New Mexico.*$"),"University of New Mexico"),e=e.replace(new RegExp("New Mexico State University.*$"),"New Mexico State University"),e},l=function(e,t){return t==="California State University-"+e||t==="California "+e||t==="California State Polytechnic University-"+e||t==="California Polytechnic State University-"+e||t===e+" State University"},c=function(e,t){$("#container").highcharts({chart:{type:"column"},title:{text:e.grad_year.slice(0,1)+"-Year Graduation Rate for First-Time, Full-Time Freshmen"},subtitle:{text:e.cohort+" Cohort"},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"% Graduated"}},legend:{enabled:!1},tooltip:{pointFormat:"Rate:{point.y:.0f}%"},series:[{data:t}]})},h=function(e,t){var n={2e3:1,2001:2,2002:3,2003:4,2004:5,2005:6,2006:7,2007:8,2008:9},r={2e3:3,2001:4,2002:5,2003:6,2004:7,2005:8,2006:9,2007:10,2008:11},i,s,o,u=[];e.grad_year==="6yr"?i=n[e.cohort]:i=r[e.cohort],t.rows.forEach(function(t,n){s=t[0],o=parseFloat(t[i]),l(e.campus,s)?(s=a(s),u[n]={name:s,y:o,color:"#635"}):(s=a(s),s=f(s),u[n]={name:s,y:o,color:"#159"})}),u=u.sort(function(e,t){return t.y-e.y});var h=u[0],p=u[1];Number.isNaN(h.y)&&(u[0]=p,u[1]=h),c(e,u)},p=function(e,t){$("#multiline_chart_container").highcharts({title:{text:"Graduation Rate Trends for First-Time, Full-Time Freshmen",x:-20},xAxis:{categories:e.years},yAxis:{title:{text:"% Grad Rate"},plotLines:[{value:0,width:1,color:"#777"}]},tooltip:{valueSuffix:"%"},legend:{title:{style:{color:"#777"},text:"(Click to show/hide campuses)"},layout:"horizontal",align:"center",width:200,borderWidth:0},series:t}),$("#trends_footnote").html("*Showing "+t[0].name+" and its four top performing national peers (based on their "+e.years.slice(-1)[0]+" cohort "+e.grad_year[0]+"-Year graduation rates).")},d=function(t,n){var i="data/"+t.type+t.grad_year+"/"+t.campus.replace(r,"_")+"_"+t.grad_year+t.type+".json"+e;$.ajax({url:i,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},v=function(e,t){var n=[],r;return e.forEach(function(e){e&&e.hasOwnProperty("name")&&e.hasOwnProperty("data")&&(r={name:e.name},e.hasOwnProperty("lineWidth")&&(r.lineWidth=e.lineWidth),r.data=e.data.slice(s[t]),n.push(r))}),n},m=function(e,t){var n=[],r,i=function(e,t,n){n[t]=parseFloat(e),n[t]=Number.isNaN(n[t])?null:n[t]};t.rows.forEach(function(t){var s=f(t[0]),o=t.slice(1);o.forEach(i),e.grad_year==="4yr"&&(o=o.slice(2)),l(e.campus,s)?r={name:a(s),data:o,lineWidth:4}:n.push({name:a(s),data:o})}),n.sort(function(e,t){return e.data.slice(-1)-t.data.slice(-1)});var s=n.slice(1-e.peer_count);return s.sort(function(e,t){return e.name>t.name?1:e.name===t.name?0:-1}),s.unshift(r),s},g=function(e,t){var n,r,i=e.years[0],s=e.years.slice(-1)[0],o=e.grad_year[0],u='<tr><td>{name}</td><td class="nowrap" style="min-width:3em;text-align:right;">{avg}</td></tr>',a=i+"-"+s+" Average Annual Improvement in "+o+"-Year Grad Rates",f='<table class="table table-striped"><tbody>';t.forEach(function(e){!e.data||e.data.slice(-1)[0]===null||e.data[0]===null||e.data.length<=1?n=u.replace("{name}",e.name).replace("{avg}","n/a"):(e.data&&e.data.length>1&&(r=""+Math.round(10*(e.data.slice(-1)[0]-e.data[0])/(e.data.length-1))/10),r.split(".").length===1&&(r+=".0"),n=u.replace("{name}",e.name).replace("{avg}",r+" % points")),f+=n}),f+="</tbody></table>",$("#text_panel_0").html("<h3>"+a+"</h3>"+f)},y=function(e,t){var n=v(m(e,t),e.years.length);p(e,n),g(e,n)},b=function(e,t){var r=function(e,t,r){var i,s=e.children.length,o=[],u,a;for(i=0;i<s;i+=1)u=e.children[i],a=u.children[t].innerText,o[i]=[a,i,u.innerHTML,u.className||""];var f=document.createDocumentFragment();r==="ascending"?o.sort(function(e,t){var r=e[0].toUpperCase(),i=t[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=Number.isNaN(parseFloat(r))?r:parseFloat(r),i=Number.isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}):o.sort(function(e,t){var r=t[0].toUpperCase(),i=e[0].toUpperCase();return r=r.indexOf("ds*")!==-1?"$0":r,i=i.indexOf("ds*")!==-1?"$0":i,r=r.replace(n,""),i=i.replace(n,""),r=Number.isNaN(parseFloat(r))?r:parseFloat(r),i=Number.isNaN(parseFloat(i))?i:parseFloat(i),r>i?1:r===i?0:-1}),o.forEach(function(e){var t=document.createElement("tr");e[3].indexOf("highlight")!==-1&&(t.className="highlight"),t.innerHTML=e[2],f.appendChild(t)}),e.innerHTML="",e.appendChild(f,e)},i={},s=[];t.forEach(function(t,n){var o="ord"+n;s.push("#col_"+n),$(s[n]).on("click",function(){!i[o]||i[o]!=="ascending"?i[o]="ascending":i[o]="descending",r(e,n,i[o])})})},w=function(e){return e=e==="Main"?"Campus":e,e=e==="Underrepresented Minority 6-Year Grad Rate"?"URM 6-Year Grad Rate":e,e=e==="% Pell Recipients Among Freshmen"?"% Pell Eligible":e,e=e==="% Underrepresented Minority"?"% URM":e,e=e==="Average High School GPA Among College Freshmen"?"Average High School GPA":e,e=e==="Estimated Median SAT / ACT"?"Average SAT&nbsp;Score":e,e=e==="Size (Undergrad FTE)"?"(Undergrad FTE)&nbsp;Size":e,e=e.replace("Grad Rate","Grad&nbsp;Rate"),e},E=function(e,t){var n="<thead><tr>",r,i=e.headers[0];t.grad_year==="4yr"?(r=i[2]==="Underrepresented Minority 6-Year Grad Rate"?2:1,i.splice(1,r,i.splice(-1,1)[0]),i[1]=t.cohort+"&nbsp;4yr Grad&nbsp;Rate"):i.splice(-1,1),i.forEach(function(e,t){e=w(e),t===0?n+='<th id="col_'+t+'" class="col_campus">'+e+"</th>":n+='<th id="col_'+t+'"  style="text-align:right;padding-right:5px;">'+e+"</th>"}),n+="</tr></thead>";var s='<tbody id="tb1">';e.rows.forEach(function(e){var n=e.slice();t.grad_year==="4yr"?n.splice(1,r,n.splice(-1,1)[0]):n.splice(-1,1),n.forEach(function(e,n){var r,i,o,c='<td class="col_campus"><a href="{link}" target="_blank" style="color:{color};text-decoration:underline;">{name}</a></td>';e==="-"&&(e="ds*"),n===0?(r=e,i="#",u.hasOwnProperty(r)&&(i=u[r]),l(t.campus,r)?(o="#b00",s+='<tr class="highlight">'):(o="#111",s+="<tr>"),r=f(r),s+=c.replace("{link}",i).replace("{name}",a(r)).replace("{color}",o)):s+='<td style="text-align:right;padding-right:5px;">'+e+"</td>"}),s+="</tr>"}),s+="</tbody>",$("#desctable").html(n+s),b($("#tb1")[0],e.headers[0])},S=function(t,n){var i="data/GRtables/"+t.campus.replace(r,"_")+"_"+t.cohort+"_briefplus.json"+e;$.ajax({url:i,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})},x=function(t,n){var r="data/peer_campus_urls.json"+e;$.ajax({url:r,datatype:"json",success:function(e){var r=typeof e=="string"?JSON.parse(e):e;n(r,t)}})};(function(){$("#campus_selector").on("change",function(e){t.campus=e.target.value,t.notify(),d(t,function(e,t){o=e,y(t,o),h(t,o)}),S(t,E)}),$("#cohort_selector_6yr").on("change",function(e){t.cohort=e.target.value,t.notify(),h(t,o),S(t,E)}),$("#cohort_selector_4yr").on("change",function(e){t.cohort=e.target.value,t.notify(),h(t,o),S(t,E)}),$("#year_selector").on("change",function(e){t.grad_year=e.target.value,t.years=i[t.grad_year].slice(s[t.trends_since]),t.notify(),d(t,function(e,t){o=e,h(t,o),y(t,o)}),S(t,E)}),$("#year_span_selector").on("change",function(e){t.trends_since=e.target.value,t.years=i[t.grad_year].slice(s[t.trends_since]),y(t,o)}),x(t,function(e,t){u=e,S(t,E)}),d(t,function(e,t){t.years=i[t.grad_year].slice(s[t.trends_since]),o=e,h(t,o),y(t,o)}),$("#label_year_selector").on("state_change",function(){["chart","trends","table"].indexOf(t.selected_tab_name)!==-1?$("#label_year_selector").show():$("#label_year_selector").hide()}),$("#label_campus_selector").on("state_change",function(){["chart","trends","table"].indexOf(t.selected_tab_name)!==-1?$("#label_campus_selector").show():$("#label_campus_selector").hide()}),$("#label_cohort_selector").on("state_change",function(){["chart","table"].indexOf(t.selected_tab_name)!==-1?$("#label_cohort_selector").show():$("#label_cohort_selector").hide()}),$("#label_year_span_selector").on("state_change",function(){t.selected_tab_name==="trends"?$("#label_year_span_selector").show():$("#label_year_span_selector").hide()}),$("#cohort_selector_6yr").on("state_change",function(){t.grad_year!=="6yr"?$("#cohort_selector_6yr").hide():(t.cohort>t.max_6yr?($("#cohort_selector_6yr").val(t.max_6yr),t.cohort=t.max_6yr):$("#cohort_selector_6yr").val(t.cohort),$("#cohort_selector_6yr").show())}),$("#cohort_selector_4yr").on("state_change",function(){t.grad_year!=="4yr"?$("#cohort_selector_4yr").hide():($("#cohort_selector_4yr").val(t.cohort),$("#cohort_selector_4yr").show())}),t.notify(),$(".nav-tabs a").on("click",function(e){$(e.target).tab("show"),t.selected_tab_name=e.target.href.split("#")[1],t.notify()})})()})